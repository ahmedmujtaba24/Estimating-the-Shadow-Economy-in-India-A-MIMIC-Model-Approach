import matplotlib.pyplot as plt
import networkx as nx
from matplotlib.patches import Ellipse

# Define the model structure
G = nx.DiGraph()

# Latent variable
G.add_node("Shadow Economy", node_type="latent")

# Causes of the shadow economy (exogenous variables)
causes = [
    "Unemployment Rate",
    "GDP per Capita",
    "Ease of Doing Business",
    "Tax-to-GDP Ratio",
    "Corruption Perception Index",
    "Inflation Rate",
    "Financial Inclusion",
    "Labor Force Participation Rate"
]

# Indicators of the shadow economy (endogenous variables)
indicators = [
    "Nighttime Light Intensity",
    "M2 Money Supply",
    "Tax Revenue Gap",
    "Electricity Consumption Deviation"
]

# Add nodes and edges
for cause in causes:
    G.add_node(cause, node_type="cause")
    G.add_edge(cause, "Shadow Economy")

for indicator in indicators:
    G.add_node(indicator, node_type="indicator")
    G.add_edge("Shadow Economy", indicator)

# Custom drawing
plt.figure(figsize=(18, 12))
pos = {}

# Position latent variable at center
pos["Shadow Economy"] = (0, 0)

# Position causes to the left (aligned vertically)
for i, cause in enumerate(causes):
    pos[cause] = (-3, 2 - i * 0.5)

# Position indicators to the right (aligned vertically)
for i, indicator in enumerate(indicators):
    pos[indicator] = (3, 2 - i * 0.5)

# Draw nodes with different shapes/colors
node_colors = []
node_shapes = []
for node in G.nodes():
    if G.nodes[node]["node_type"] == "latent":
        node_colors.append("orange")
        node_shapes.append("s")  # square for latent
    elif G.nodes[node]["node_type"] == "cause":
        node_colors.append("skyblue")
        node_shapes.append("o")  # circle for causes
    else:
        node_colors.append("lightgreen")
        node_shapes.append("d")  # diamond for indicators

# Draw the graph
nx.draw_networkx_nodes(G, pos, node_color=node_colors, node_size=2500)
nx.draw_networkx_edges(G, pos, arrowstyle='->', arrowsize=20, width=1.5)
nx.draw_networkx_labels(G, pos, font_size=10, font_weight='bold')

# Create legend
legend_elements = [
    plt.Line2D([0], [0], marker='s', color='w', label='Latent Variable',
              markerfacecolor='orange', markersize=15),
    plt.Line2D([0], [0], marker='o', color='w', label='Causes',
              markerfacecolor='skyblue', markersize=15),
    plt.Line2D([0], [0], marker='d', color='w', label='Indicators',
              markerfacecolor='lightgreen', markersize=15)
]
plt.legend(handles=legend_elements, loc='upper right')

plt.title("MIMIC Model Structure: India's Shadow Economy", fontsize=16)
plt.xlim(-4, 4)
plt.ylim(-2, 3)
plt.axis('off')
plt.tight_layout()
plt.show()
